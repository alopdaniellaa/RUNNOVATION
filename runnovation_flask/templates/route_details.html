{% extends "base.html" %}
{% block title %}Route Details - Runnovation{% endblock %}

{% block content %}
<h1 class="text-xl font-semibold mb-1">Route Details</h1>

<div class="grid md:grid-cols-2 gap-6 mt-4">

    <!-- LEFT: STRAVA DATA -->
    <div class="bg-[var(--bg-card)] border border-[#333] rounded-2xl p-4 shadow-lg">
        <h3 class="text-sm font-semibold mb-1">{{ route.name }}</h3>
        <p class="text-[10px] text-[var(--text-secondary)] mb-3">
            Source: <span class="text-white font-medium">Strava API Data</span>
        </p>

        <p class="text-[11px] text-white mb-1">
            Distance: {{ route.distance_km }} km · Pace: {{ route.avg_pace_min_per_km }} min/km
        </p>
        <p class="text-[11px] text-white mb-1">
            Elevation Gain: {{ route.elevation_gain }} m · Difficulty: {{ route.difficulty }}
        </p>
        <p class="text-[11px] text-white mb-1">
            Heatmap Intensity: {{ route.heatmap_intensity }} · Popularity: {{ route.popularity }}
        </p>
        <p class="text-[11px] text-white mb-3">
            Suggested Time: {{ route.best_time }}
        </p>

        <div class="bg-[#1A1A1A] rounded-md h-32 flex items-center justify-center text-[11px] text-[var(--text-secondary)] mt-3">
            [Route Map / Heatmap Placeholder]<br>
            (Desktop Strava Map Visualization)
        </div>
    </div>

    <!-- RIGHT: APP DATA -->
    <div class="bg-[var(--bg-card)] border border-[#333] rounded-2xl p-4 shadow-lg">
        <h3 class="text-sm font-semibold mb-1">Community Insights</h3>
        <p class="text-[10px] text-[var(--text-secondary)] mb-3">
            Source: <span class="text-white font-medium">Runnovation App (User-Submitted)</span>
        </p>

        <p class="text-[11px] text-white mb-2">
            Community Difficulty Rating:
            {% if agg and agg["avg_diff"] %}
                {{ "%.1f"|format(agg["avg_diff"]) }} / 5
            {% else %}No data yet{% endif %}
        </p>
        <p class="text-[11px] text-white mb-2">
            Community Safety Score:
            {% if agg and agg["avg_safety"] %}
                {{ "%.1f"|format(agg["avg_safety"]) }} / 5
            {% else %}No data yet{% endif %}
        </p>

        <a href="{{ url_for('submit_feedback', route_id=route.id) }}"
           class="inline-block mt-2 mb-3 px-3 py-1 text-[11px] rounded-full bg-[var(--brand-orange)] text-black font-semibold">
            Submit Route Feedback
        </a>

        <div class="mt-3 border-t border-[#333] pt-3">
            <h4 class="text-[11px] font-semibold mb-2">User Comments</h4>
            {% if comments %}
                <div class="space-y-2 max-h-48 overflow-auto text-[11px]">
                    {% for c in comments %}
                    <div class="border border-[#333] rounded-md p-2 bg-[#1A1A1A]">
                        <p class="text-white mb-1">
                            <strong>{{ c.full_name }}</strong>
                            · Diff: {{ c.difficulty_rating }}/5 · Safety: {{ c.safety_rating }}/5
                        </p>
                        <p class="text-[var(--text-secondary)]">{{ c.comment or "No comment" }}</p>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-[11px] text-[var(--text-secondary)]">
                    No feedback yet. Be the first to share your experience.
                </p>
            {% endif %}
        </div>

        <a href="{{ url_for('route_analytics') }}"
           class="inline-block mt-3 text-[11px] text-[var(--brand-orange)] underline">
            Back to Route Analytics
        </a>
    </div>
</div>
{% endblock %}
