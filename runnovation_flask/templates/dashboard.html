{% extends "base.html" %}
{% block title %}Dashboard - Runnovation{% endblock %}

{% block content %}

<!-- HERO WELCOME SECTION -->
<section class="mb-8">
    <h1 class="text-2xl font-semibold mb-1">
        Good Day, {{ user.full_name.split(' ')[0] if user.full_name else 'Runner' }}!
    </h1>
    <p class="text-sm text-[var(--text-secondary)]">
        Ready for your next run?
    </p>
</section>

<!-- TOP RATED ROUTES CARD -->
<div class="bg-[var(--bg-card)] border border-[#333] rounded-2xl p-5 shadow-lg mb-8">
    <h3 class="text-sm font-semibold mb-3">Top-Rated Routes</h3>

    {% if top_routes %}
        <div class="grid md:grid-cols-3 gap-4">
            {% for rt in top_routes %}
            <a href="{{ url_for('route_details', route_id=rt.id) }}"
               class="block bg-[#1A1A1A] rounded-xl p-4 border border-[#333] hover:border-[var(--brand-orange)] transition">

                <p class="text-sm font-semibold text-white mb-1">{{ rt.name }}</p>

                <!-- Stars -->
                <div class="flex items-center mb-1">
                    {% set score = rt.avg_diff|round(0, 'floor') %}
                    {% for i in range(1,6) %}
                        {% if i <= score %}
                            <span class="text-[var(--brand-orange)] text-sm">★</span>
                        {% else %}
                            <span class="text-[#555] text-sm">★</span>
                        {% endif %}
                    {% endfor %}
                </div>

                <p class="text-[11px] text-[var(--text-secondary)]">
                    Difficulty: {{ "%.1f"|format(rt.avg_diff) }} / 5
                </p>
                <p class="text-[11px] text-[var(--text-secondary)]">
                    Safety: {{ "%.1f"|format(rt.avg_safety) }} / 5
                </p>
                <p class="text-[11px] text-[var(--text-secondary)]">
                    Reviews: {{ rt.review_count }}
                </p>
            </a>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-[12px] text-[var(--text-secondary)]">
            No community ratings yet. Submit feedback to see top routes.
        </p>
    {% endif %}
</div>

<!-- MAIN CARD GRID -->
<section class="grid gap-5 md:grid-cols-2 lg:grid-cols-3">

    <!-- STRAVA CONNECTION CARD -->
    {% if not user.strava_connected %}
        <a href="{{ url_for('connect_strava_link_existing') }}"
           class="block bg-[var(--bg-card)] border border-[#333] rounded-2xl p-5 shadow-lg hover:border-[var(--brand-orange)] transition">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-semibold">Connect Strava Account</h3>
                <span class="text-xs text-[var(--brand-orange)]">Sync</span>
            </div>
            <p class="text-xs text-[var(--text-secondary)]">
                Sync your Strava activities to unlock route and performance analytics.
            </p>
        </a>
    {% else %}
        <div class="bg-[var(--bg-card)] border border-[#333] rounded-2xl p-5 shadow-lg">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-semibold">Strava Status</h3>
                <span class="text-xs text-emerald-400 font-semibold">Connected</span>
            </div>
            <p class="text-xs text-[var(--text-secondary)]">
                Your Strava account is connected. New activities can be synced and analyzed.
            </p>
            <p class="text-[10px] text-[var(--text-secondary)] mt-2">
                Tip: Go to <span class="text-white font-medium">Strava Analytics</span> to view pace, distance and elevation trends.
            </p>
        </div>
    {% endif %}

    <!-- STRAVA ANALYTICS -->
    <a href="{{ url_for('strava_analytics') }}"
       class="block bg-[var(--bg-card)] border border-[#333] rounded-2xl p-5 shadow-lg hover:border-[var(--brand-orange)] transition">
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-semibold">Strava Analytics</h3>
            <span class="text-xs text-[var(--brand-orange)]">View</span>
        </div>
        <p class="text-xs text-[var(--text-secondary)]">
            Analyze pace, distance, elevation and running frequency trends.
        </p>
        <p class="text-[10px] text-[var(--text-secondary)] mt-2">
            Data Source: <span class="text-white font-medium">Strava API</span>
        </p>
    </a>

    <!-- ROUTE ANALYTICS -->
    <a href="{{ url_for('route_analytics') }}"
       class="block bg-[var(--bg-card)] border border-[#333] rounded-2xl p-5 shadow-lg hover:border-[var(--brand-orange)] transition">
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-semibold">Route Analytics</h3>
            <span class="text-xs text-[var(--brand-orange)]">Routes</span>
        </div>
        <p class="text-xs text-[var(--text-secondary)]">
            Explore Strava-based routes, difficulty, elevation and heatmap intensity.
        </p>
        <p class="text-[10px] text-[var(--text-secondary)] mt-2">
            Basis: <span class="text-white font-medium">Strava Route Data</span>
        </p>
    </a>

    <!-- COMMUNITY FEEDBACK -->
    <a href="{{ url_for('community_insights') }}"
       class="block bg-[var(--bg-card)] border border-[#333] rounded-2xl p-5 shadow-lg hover:border-[var(--brand-orange)] transition">
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-semibold">Community Feedback</h3>
            <span class="text-xs text-[var(--brand-orange)]">Insights</span>
        </div>
        <p class="text-xs text-[var(--text-secondary)]">
            See community difficulty and safety ratings for your routes.
        </p>
        <p class="text-[10px] text-[var(--text-secondary)] mt-2">
            Source: <span class="text-white font-medium">Runnovation App Data</span>
        </p>
    </a>

    <!-- PROFILE SETTINGS -->
    <a href="{{ url_for('profile') }}"
       class="block bg-[var(--bg-card)] border border-[#333] rounded-2xl p-5 shadow-lg hover:border-[var(--brand-orange)] transition">
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-semibold">Profile Settings</h3>
            <span class="text-xs text-[var(--brand-orange)]">Account</span>
        </div>
        <p class="text-xs text-[var(--text-secondary)]">
            Manage your name, email, password and Strava connection.
        </p>
    </a>

</section>

{% endblock %}
